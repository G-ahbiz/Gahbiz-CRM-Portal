<div class="container-fluid p-0 m-0">
  <div class="card border-0 bg-transparent">
    <p-table
      #dt1
      [value]="leadsData()"
      dataKey="id"
      sortField="id"
      [sortOrder]="1"
      [tableStyle]="{ 'min-width': '60rem' }"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      [lazy]="true"
      (onPage)="onPageChange($event)"
      [loading]="loading()"
      [globalFilterFields]="[
        'firstName',
        'lasttName',
        'servicesOfInterest',
        'status',
        'sourceName',
        'assignedTo',
        'creadtedAt'
      ]"
    >
      <ng-template #caption>
        <div class="d-flex justify-content-between align-items-center">
          <!-- Filter and Search Container -->
          <div class="d-flex justify-content-start align-items-center gap-0">
            <button
              type="button"
              class="btn btn-sm btn-outline-primary outline-primary-clr p-2"
              (click)="clear(dt1)"
            >
              <i class="pi pi-filter-slash"></i>
              Clear
            </button>
            <p-iconfield iconPosition="left" class="fw-bold">
              <p-inputicon>
                <i class="pi pi-search"></i>
              </p-inputicon>
              <input
                pInputText
                type="text"
                (input)="onSearch($event)"
                #searchInput
                placeholder="Search keyword"
              />
            </p-iconfield>
          </div>

          <!-- Add Lead Button Container -->
          <div class="d-flex justify-content-start align-items-center gap-0">
            <button
              class="btn btn-primary primary-bg-clr d-flex justify-content-start px-3 py-2 align-items-center gap-2 rounded-3"
              routerLink="/main/sales/leads/add-lead"
            >
              <img src="assets/images/shared/plus.svg" alt="" class="" />
              Add Lead
            </button>
          </div>
        </div>
        <div class="title-container my-4">
          <h5 class="m-0 p-0">All Leads</h5>
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th class="d-flex justify-content-center align-items-center gap-2">
            <div class="flex items-center gap-2">
              <input
                type="checkbox"
                name="select-all"
                id="select-all"
                [checked]="isAllSelected"
                (change)="onSelectAll($event)"
              />
            </div>
          </th>
          <th [pSortableColumn]="'id'">
            <div class="flex items-center gap-2">
              ID
              <p-sortIcon field="'ID'" />
            </div>
          </th>
          <th [pSortableColumn]="'firstName'">
            <div class="flex items-center gap-2">
              Name
              <p-sortIcon field="'firstName'" />
            </div>
          </th>
          <th [pSortableColumn]="'servicesOfInterest'">
            <div class="flex items-center gap-2">
              Service
              <p-sortIcon field="'servicesOfInterest'" />
            </div>
          </th>
          <th [pSortableColumn]="'status'">
            <div class="flex items-center gap-2">
              Status
              <p-sortIcon field="'status'" />
            </div>
          </th>
          <th [pSortableColumn]="'sourceName'">
            <div class="flex items-center gap-2">
              Source
              <p-sortIcon field="'sourceName'" />
            </div>
          </th>
          <th [pSortableColumn]="'assignedTo'">
            <div class="flex items-center gap-2">
              Assigned To
              <p-sortIcon field="'assignedTo'" />
            </div>
          </th>
          <th [pSortableColumn]="'value'">
            <div class="flex items-center gap-2">
              Value
              <p-sortIcon field="'value'" />
            </div>
          </th>
          <th [pSortableColumn]="'creadtedAt'">
            <div class="flex items-center gap-2">
              Created Date
              <p-sortIcon field="'creadtedAt'" />
            </div>
          </th>
          <th class="d-flex justify-content-center align-items-center gap-2">Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-lead>
        <tr>
          <td>
            <input
              type="checkbox"
              name="select-lead"
              id="lead-{{ lead.id }}"
              [checked]="lead.selected"
              (change)="toggleLeadSelection(lead)"
            />
          </td>
          <td>{{ lead.id }}</td>
          <td>{{ lead.firstName }} {{ lead.lasttName }}</td>
          <td>{{ lead.servicesOfInterest?.join(', ') }}</td>
          <td>
            <span
              class="py-1 px-2 rounded-3"
              [class]="
                lead.status === 'New'
                  ? 'text-white bg-black'
                  : lead.status === 'Qualified'
                  ? 'text-success card-green'
                  : lead.status === 'In-Progress'
                  ? 'text-warning card-yellow'
                  : lead.status === 'Lost'
                  ? 'text-danger card-red'
                  : ''
              "
              >{{ lead.status }}</span
            >
          </td>
          <td>{{ lead.sourceName }}</td>
          <td>{{ lead.assignedTo }}</td>
          <td>-</td>
          <td>{{ lead.creadtedAt }}</td>
          <td class="d-flex justify-content-center align-items-center gap-2">
            <button class="btn btn-sm" (click)="viewLead(lead.id); $event.stopPropagation()">
              <img src="assets/images/shared/eye.svg" alt="" class="" />
            </button>
            <button class="btn btn-sm" (click)="editLead(lead.id); $event.stopPropagation()">
              <i class="pi pi-pencil"></i>
            </button>
            <button class="btn btn-sm" (click)="onDeleteLead(lead.id); $event.stopPropagation()">
              <i class="pi pi-trash"></i>
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
