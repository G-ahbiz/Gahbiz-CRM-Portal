<div class="container-fluid p-0 m-0">
  <div
    class="update-invoice-container p-3 d-flex flex-column justify-content-start align-items-start gap-3 overflow-y-auto"
  >
    <div class="update-invoice-top w-100 d-flex justify-content-start align-items-center gap-3">
      <div class="update-invoice-back-btn-container">
        <button
          class="back-btn btn btn-sm p-2 border-0 bg-white shadow d-flex justify-content-center align-items-center"
          (click)="goBack()"
        >
          <i class="pi pi-chevron-left fs-875"></i>
        </button>
      </div>
      <div class="update-invoice-title-container">
        <h1 class="mb-0 fs-4 fw-bold">
          {{ 'invoices-crm.update-invoice-page.title' | translate }}
        </h1>
      </div>
    </div>

    @if (loading()) {
    <div class="w-100 d-flex justify-content-center align-items-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    } @if (!loading() && invoice()) {
    <form
      [formGroup]="updateInvoiceForm"
      class="update-invoice-form w-100 d-flex flex-column justify-content-start align-items-start gap-4 mt-4 p-5 bg-white"
    >
      <!-- Amount Paid Container -->
      <div
        class="amount-paid-container d-flex justify-content-between align-items-start gap-3 w-100"
      >
        <div class="form-group w-100">
          <label for="amountPaid">
            {{ 'invoices-crm.update-invoice-page.amount-paid' | translate }}
            <span [class]="checkValidity('amountPaid')">*</span>
          </label>
          <input
            type="number"
            name="amountPaid"
            id="amountPaid"
            class="form-control"
            placeholder="{{ 'invoices-crm.update-invoice-page.amount-paid' | translate }}"
            formControlName="amountPaid"
            min="0"
          />
          @if (updateInvoiceForm.get('amountPaid')?.touched &&
          updateInvoiceForm.get('amountPaid')?.errors) {
          <small class="text-danger">
            @if (updateInvoiceForm.get('amountPaid')?.errors?.['required']) {
            {{ 'invoices-crm.update-invoice-page.amount-paid-required' | translate }}
            } @if (updateInvoiceForm.get('amountPaid')?.errors?.['min']) {
            {{ 'invoices-crm.update-invoice-page.amount-paid-min' | translate }}
            }
          </small>
          }
        </div>
      </div>

      <!-- Status Container -->
      <div class="status-container d-flex justify-content-between align-items-start gap-3 w-100">
        <div class="form-group w-100">
          <label for="status">
            {{ 'invoices-crm.update-invoice-page.status' | translate }}
            <span [class]="checkValidity('status')">*</span>
          </label>
          <select name="status" id="status" class="form-select" formControlName="status">
            <option value="" disabled>
              {{ 'invoices-crm.update-invoice-page.select-status' | translate }}
            </option>
            <option value="Unpaid">
              {{ 'invoices-crm.update-invoice-page.unpaid' | translate }}
            </option>
            <option value="PartiallyPaid">
              {{ 'invoices-crm.update-invoice-page.partially-paid' | translate }}
            </option>
            <option value="Paid">{{ 'invoices-crm.update-invoice-page.paid' | translate }}</option>
          </select>
          @if (updateInvoiceForm.get('status')?.touched &&
          updateInvoiceForm.get('status')?.errors?.['required']) {
          <small class="text-danger">
            {{ 'invoices-crm.update-invoice-page.status-required' | translate }}
          </small>
          }
        </div>
      </div>

      <!-- Notes Container -->
      <div class="notes-container d-flex justify-content-between align-items-start gap-3 w-100">
        <div class="form-group w-100">
          <label for="notes">
            {{ 'invoices-crm.update-invoice-page.notes' | translate }}
          </label>
          <textarea
            name="notes"
            id="notes"
            class="form-control"
            rows="4"
            placeholder="{{ 'invoices-crm.update-invoice-page.notes-placeholder' | translate }}"
            formControlName="notes"
          ></textarea>
        </div>
      </div>

      <!-- Buttons Container -->
      <div
        class="buttons-container d-flex justify-content-center align-items-center gap-3 w-100 mt-4"
      >
        <button
          type="button"
          class="btn btn-sm outline-primary-clr px-3 py-2 d-flex justify-content-center align-items-center gap-2 rounded-3 flex-grow-1"
          (click)="cancel()"
          [disabled]="submitting()"
        >
          {{ 'invoices-crm.update-invoice-page.cancel' | translate }}
        </button>
        <button
          type="submit"
          class="btn btn-sm btn-primary primary-bg-clr px-3 py-2 d-flex justify-content-center align-items-center gap-2 rounded-3 flex-grow-1"
          (click)="updateInvoice()"
          [disabled]="submitting() || updateInvoiceForm.invalid"
        >
          @if (submitting()) {
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          }
          {{ 'invoices-crm.update-invoice-page.save' | translate }}
        </button>
      </div>
    </form>
    }
  </div>
</div>
